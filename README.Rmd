---
output: 
  github_document: 
    default
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "fig/README-"
)
```

# printy

Over the years, I've written a lot of one-off functions for formatting numbers
in RMarkdown documents. This packages collects them in a single location.

## Installation

You can install printy from github with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
remotes::install_github("tjmahr/printy")
```

## Examples

Print a number with n digits of precision. R numbers lose precision when 
converted to strings. This function converts the numbers to strings and keeps
precision. (It's a wrapper for `sprintf()`.)

```{r fix-digits}
library(dplyr, warn.conflicts = FALSE)
library(printy)
test_cor <- cor(mtcars[, 1:4]) 

# Typical loss of trailing zeroes
test_cor[1:4, 3] %>% round(2) %>% as.character()

test_cor[1:4, 3] %>% fmt_fix_digits(2)
```

Don't print a leading zero on numbers that are bounded between &minus;1 and 1,
such as correlations or _p_-values.

```{r leading-zero}
fmt_leading_zero(c(-0.3, 0.4, 1))

# Todo: This functions obliterates 0's
fmt_leading_zero(c(0, 0.0))
```

Format negative numbers with a minus sign.

```{r minus-sign}
fmt_minus_sign(c(1, 2, -3, -0.4, -pi))
```

Putting it all together.

```{r}
fmt_correlation <- function(xs, digits = 2) {
  xs %>% fmt_fix_digits(digits) %>% fmt_leading_zero() %>% fmt_minus_sign()
}

test_cor %>% 
  as.data.frame() %>% 
  tibble::rownames_to_column(".rowname") %>% 
  tibble::as_tibble() %>% 
  mutate_at(vars(-.rowname), fmt_correlation) %>% 
  rename(` ` = .rowname) %>% 
  knitr::kable(align = "lrrrr")
```

### *p*-values

Format *p*-values with *n* digits of precision, with no leading zero, and with
very small values being printed with a `<` sign.

```{r}
p <- c(1, 0.1, 0.01, 0.001, 0.0001)
fmt_p_value(p, digits = 2)
fmt_p_value(p, digits = 3)
```

Print *p*-values in markdown with nice defaults. 

* Use 3 digits of precision for values less than .06
* Otherwise, use 2 digits of precision.
* Include *p* in markdown

```{r}
p <- c(1, 0.1, 0.06, 0.059, 0.051, 0.01, 0.001, 0.0001)
fmt_p_value_md(p)
```

These render as: `r paste0(fmt_p_value_md(p), collapse = ", ")`.

## Formatting tables from lme4 models

One thing I've had to do a lot is summarize mixed effects models fit with lme4.
This package provides `pretty_lme4_ranefs()` which creates a dataframe random
effect variances and covariances like those printed by `summary()`.

For example, we can fit the model.

```{r}
library(lme4)
model <- lmer(Reaction ~ Days + (Days | Subject), sleepstudy)
summary(model)
```

`pretty_lme4_ranefs()` creates the following dataframe.

```{r}
pretty_lme4_ranefs(model)
```

Which in markdown renders as

```{r}
knitr::kable(pretty_lme4_ranefs(model), align = c("l", "l", "r", "r", "r"))
```

Here's a dumb model with a lot going on in the random effects.

```{r, warning = FALSE}
model <- lmer(mpg ~ wt * hp + (drat | gear) + (hp * cyl | am), mtcars)
model

knitr::kable(pretty_lme4_ranefs(model), 
             align = c("l", "l", "r", "r", "r", "r", "r", "r", "r"))
```

